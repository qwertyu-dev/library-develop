= 役員情報管理機能

== 1. 現状分析

=== 1.1 現行システムの概要

現行システムでは、通常の部署情報と役員情報が別々に管理されています。リファレンスデータベース（以下、リファレンスDB）には、同一部署に対して通常の部署レコードと役員レコードが複数存在する状態となっています。

=== 1.2 運用フロー

1. 秘書室から役員に関する特別な対応の相談が来る
2. 役員の所属部署の明細に加えて、その役員用の特別な設定明細を新規作成する
3. 設定値の変更が必要な場合は、リファレンスDBを直接修正する
4. 役員扱いを解除する場合は、該当する役員設定レコードを削除する

=== 1.3 課題点

1. 人事部と秘書室の運用が連携していないため、人事部による通常部署の変更が役員レコードに反映されない
2. 役員レコードの更新が人的な気づきと手動の対応に依存しており、更新漏れのリスクが高い
3. 担当者の引き継ぎ漏れによる問題発生の可能性がある
4. 手動での直接的なデータベース操作によるデータ整合性リスクがある

== 2. 秘書室要件

=== 2.1 役員情報の特殊性

1. BPR部店名、課Gr名（Outlook表示名）を所属部署名ではなく「役員」として表示する必要がある
2. 役員部店登録データのDPコードカラムには、部署固有のDPコードではなく秘書室と同じDPコード（CP6901）を設定する必要がある

=== 2.2 要求事項

1. 役員情報の特殊性を維持しつつ、通常の部署情報変更に追従する仕組みが必要
2. 秘書室からの要請に基づく柔軟な役員情報の更新が可能であること
3. 役員情報の更新漏れを防止する仕組みが必要

== 3. 新システムの設計

=== 3.1 基本方針

1. 現行の運用フローを大きく変更せず、システム的なサポートを強化する
2. 自動化と人的判断のバランスを取り、柔軟性を維持しつつエラーリスクを低減する
3. 役員レコードの特殊性を維持しながら、通常部署情報との整合性を確保する

=== 3.2 機能概要

1. パッチ生成の半自動化機能
   - 頻出するパッチパターンをテンプレート化
   - パラメータ入力によるパッチ自動生成
   - パッチ生成履歴の記録と管理

2. 動的BlackList機能
   - リファレンスDBからの役員レコード情報の定期的抽出
   - BlackListの自動更新と履歴管理

3. 通知システム
   - 人事部からの通常部署更新時、対応する役員レコードが存在する場合に運用担当者へ通知

== 4. 処理フロー

=== 4.1 秘書室から単独依頼ケース -- 変更依頼

[plantuml]
....
@startuml
actor 秘書室
participant 運用担当者
participant パッチ生成システム
participant リファレンスDB

秘書室->>運用担当者: 役員情報変更依頼
運用担当者->>パッチ生成システム: パッチ生成要求
パッチ生成システム-->>運用担当者: パッチ生成
運用担当者->>運用担当者: パッチ内容確認
運用担当者->>パッチ生成システム: パッチ適用指示
パッチ生成システム->>リファレンスDB: 役員情報更新
パッチ生成システム->>パッチ生成システム: パッチ履歴記録
パッチ生成システム-->>運用担当者: 更新完了通知
運用担当者->>秘書室: 変更完了報告
@enduml
....

=== 4.2 秘書室から単独依頼ケース -- 削除依頼

[plantuml]
....
@startuml
actor 秘書室
participant 運用担当者
participant パッチ生成システム
participant リファレンスDB
participant BlackList管理システム

秘書室->>運用担当者: 役員情報削除依頼
運用担当者->>パッチ生成システム: 削除パッチ生成要求
パッチ生成システム-->>運用担当者: 削除パッチ生成
運用担当者->>運用担当者: パッチ内容確認
運用担当者->>パッチ生成システム: パッチ適用指示
パッチ生成システム->>リファレンスDB: 役員情報削除
パッチ生成システム->>パッチ生成システム: パッチ履歴記録
パッチ生成システム->>BlackList管理システム: BlackList更新要求
BlackList管理システム->>BlackList管理システム: BlackListから該当エントリ削除
BlackList管理システム-->>パッチ生成システム: BlackList更新完了通知
パッチ生成システム-->>運用担当者: 削除完了通知
運用担当者->>秘書室: 削除完了報告
@enduml
....

=== 4.3 人事部から部署情報修正依頼ケース -- 変更依頼

[plantuml]
....
@startuml
actor 人事部
participant システム
participant BlackList管理システム
participant リファレンスDB
participant 運用担当者
participant パッチ生成システム

人事部->>システム: 部署情報変更依頼
システム->>BlackList管理システム: BlackListチェック要求
BlackList管理システム-->>システム: チェック結果

alt BlackListに該当
    システム->>運用担当者: 役員情報更新の必要性を通知
    運用担当者->>パッチ生成システム: 役員情報更新パッチ生成要求
    パッチ生成システム-->>運用担当者: 更新パッチ生成
    運用担当者->>運用担当者: パッチ内容確認
    運用担当者->>パッチ生成システム: パッチ適用指示
    パッチ生成システム->>リファレンスDB: 役員情報更新
    パッチ生成システム->>パッチ生成システム: パッチ履歴記録
    パッチ生成システム-->>運用担当者: 役員情報更新完了通知
end

システム->>リファレンスDB: 通常部署情報更新
システム-->>人事部: 更新完了通知
@enduml
....

=== 4.4 人事部から部署情報修正依頼ケース -- 削除依頼

[plantuml]
....
@startuml
actor 人事部
participant システム
participant BlackList管理システム
participant リファレンスDB
participant 運用担当者
participant パッチ生成システム

人事部->>システム: 部署情報削除依頼
システム->>BlackList管理システム: BlackListチェック要求
BlackList管理システム-->>システム: チェック結果

alt BlackListに該当
    システム->>運用担当者: 役員情報削除の必要性を通知
    運用担当者->>パッチ生成システム: 役員情報削除パッチ生成要求
    パッチ生成システム-->>運用担当者: 削除パッチ生成
    運用担当者->>運用担当者: パッチ内容確認
    運用担当者->>パッチ生成システム: パッチ適用指示
    パッチ生成システム->>リファレンスDB: 役員情報削除
    パッチ生成システム->>パッチ生成システム: パッチ履歴記録
    パッチ生成システム->>BlackList管理システム: BlackList更新要求
    BlackList管理システム->>BlackList管理システム: BlackListから該当エントリ削除
    BlackList管理システム-->>パッチ生成システム: BlackList更新完了通知
    パッチ生成システム-->>運用担当者: 役員情報削除完了通知
end

システム->>リファレンスDB: 通常部署情報削除
システム-->>人事部: 削除完了通知
@enduml
....

== 5. 改善策の詳細

=== 5.1 パッチ生成の半自動化

1. パッチテンプレートの作成
   - 新規作成（今後は発生しない）
   - 更新
   - 削除

2. パッチ生成インターフェースの開発
   - 必要パラメータの入力フォーム
   - テンプレート選択機能
   - プレビュー機能

3. パッチ適用機能の実装
   - リファレンスDBへの適用処理
   - エラーハンドリングとロールバック機能

4. パッチ履歴管理機能の実装
   - パッチ管理テーブルへの記録
   - 適用状態の追跡
   - 履歴閲覧・検索機能

=== 5.2 動的BlackListの実装

1. BlackListテーブルの作成
   - 部署コード、役員フラグ、最終更新日時を含む

2. 自動更新処理の実装
   - リファレンスDBからの役員レコード抽出ロジック
   - BlackListテーブルとの差分比較ロジック
   - 更新処理とログ記録

3. BlackList参照機能の実装
   - 人事部からの更新申請時にBlackListをチェックするロジック
   - 該当する場合の通知機能

=== 5.3 通知システムの構築

1. 通知トリガーの実装
   - BlackListに該当する部署の更新時に発火

2. 通知内容の生成
   - 更新対象部署の情報
   - 対応する役員レコードの情報
   - 推奨アクション

3. SMTP通知機能の実装
   - 運用担当者へのメール送信
   - エラーハンドリングと再送機能

4. 通知履歴の管理
   - 送信日時、対象部署、通知内容のログ記録
   - 履歴閲覧・検索機能

これらの改善策により、役員情報管理の効率化、エラー防止、そしてトレーサビリティの向上が期待できます。システムの導入後も定期的な運用状況の確認と、必要に応じた調整を行うことで、より効果的な役員情報管理が実現できます。