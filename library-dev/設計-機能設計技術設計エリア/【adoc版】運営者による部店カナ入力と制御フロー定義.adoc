= 部店名カナ設定システム 機能設計書

== 現状の課題
現行では人による判断で部店名称から部店カナを運用者が入力しています。ただし過去にはそのカナ名称判断にゆらぎがあり、ベースのルールはあるものの本来ある要件を満たさないデータとして存在している。


* 人的ミス：手動での入力や確認作業により、誤入力や見落としが発生している +
* 公式情報との不整合：銀行や関連会社の公式情報と、システム上の表記が異なるケースが散見される +
* 系統的なチェック機能の不足：入力されたカナ表記の妥当性を系統的にチェックする仕組みが不十分 +

== 移植での課題対応

部店名称から部店カナを生成する実装を検討したものの、銀行固有ルール適用に多岐にわたるルール設定や既存のリファレンスデータの不備により変換精度は100%に至らない結果となった。またコードの保守性は低いコードとなってしまい将来に渡り負の資産になる懸念がある。

従って、移植時でも人による判断で部店カナを設定する運用でやむなしとする。ただし部店カナ設定の際にはルール厳格化／チェックリストによる検出を行い現状から改良できるよう仕組みを設定する

== 継続検討課題
* 新規の場合は一括申請フェーズで部店カナ記載ありValidationを設定する
* 変更の場合、部店名称変更時に運用担当者の対応漏れ検出
** 漏れるとリファレンステーブルからの情報をセットする挙動になる
** 部店名称を比較対象とせざるを得ないが、不安定な情報をベースに判断をするべきか

.移植後の対処
[cols="1,3", options="header"]
|===
|目的                   |説明
|カナ表記の標準化       |拗音の処理や特殊文字の扱いを明確に定義し、一貫した表記を実現する
|公式情報との整合性確保 |銀行HPや関連会社HPとの自動照合機能を実装し、正確性を向上させる
|ユーザー支援の強化     |チェックリストやエラー警告機能を通じて、操作者の判断をサポートする
|データ品質の向上       |厳密な検証プロセスにより、部店名カナデータの全体的な品質を向上させる
|===

== 機能要件
=== 部店名カナ設定機能

.基本情報入力
[cols="1,3", options="header"]
|===
|機能|説明
|部店名称（漢字）の入力|部店の正式名称を漢字で入力する機能
|部店コードの入力|部店を一意に識別するコードを入力する機能
|申請タイプの選択|新規、変更、廃止から適切な申請タイプを選択する機能
|===

.カナ表記変換
[cols="1,3", options="header"]
|===
|機能|説明
|漢字からカナへの自動変換|入力された漢字を自動的にカナに変換する機能
|拗音の通常カナ表現への変換|拗音を通常のカナ表現に変換する機能（例：チョ→チヨ）
|長音符（ー）の適切な使用|カナ表記における長音符の適切な使用を管理する機能
|===

.特殊文字・略称処理
[cols="1,3", options="header"]
|===
|機能|説明
|略称のカナ変換対象外処理|㈱、（財）、（社）などの略称をカナ変換対象外として処理する機能
|特殊文字の適切な処理|中黒点（・）、括弧（）などの特殊文字を適切に処理する機能
|===

.拗音処理機能
[cols="1,3", options="header"]
|===
|機能|説明
|拗音の識別|入力された文字列から拗音を自動的に識別する機能
|通常カナ表現への変換
a| * 識別された拗音を通常のカナ表現に変換する機能
** チャ → チヤ
** チュ → チユ
** チョ → チヨ
** その他の拗音も同様に変換
|===


.データ検証機能
[cols="1,3", options="header"]
|===
|機能|説明
|入力データの妥当性チェック
a|
* 必須項目の入力チェック
* 文字種の妥当性チェック（全角カタカナ、許可された特殊文字のみ）

|文字種・文字数チェック
a|
* 全角カタカナのみであることの確認（特殊略称・記号を除く）
* システムの文字数制限内であることの確認

|一貫性チェック
a|
* 同一漢字に対するカナ表記の一貫性チェック
* 拗音の通常カナ表現の一貫性チェック
* 特殊略称・記号の扱いの一貫性チェック
|===

.公式情報参照機能
[cols="1,3", options="header"]
|===
|機能|説明
|銀行HP参照
a|
* 運用者が対応する 

|関連会社HP参照機能
a|
* 運用者が対応する 
|===

=== ユーザー支援機能

==== チェックリスト表示機能
- 部店名カナ設定チェックリストの表示機能
- チェックリストの各項目に対する確認状況の記録機能

==== エラー・警告メッセージ表示
- データ検証結果に基づくエラーメッセージの表示
- 公式情報との不一致に関する警告メッセージの表示

== 処理フロー

=== 部店名カナ設定フロー

==== 申請データ作成
1. ユーザーが基本情報を入力
2. 申請タイプ（新規、変更、廃止）を選択
3. 新規申請または名称変更の場合、ユーザーが部店名カナを入力
4. その他の変更の場合、部店名カナ欄を空欄のまま

==== 一括申請フェーズ
1. 申請データの受付
2. 入力データの基本的なバリデーション

==== 統一フォーマット変換
1. 申請フォームのデータを統一フォーマットに変換
2. 部店カナを統合レイアウトにマッピング

==== 受付フェーズ
1. 統一フォーマットデータの受け取り
2. 部店カナ欄が空欄の場合、リファレンスDBから部店カナを取得
3. 部店カナ欄が入力済みの場合、その値を使用

[plantuml]
----
@startuml
skinparam ActivityBackgroundColor<<申請前>> LightYellow
skinparam ActivityBackgroundColor<<申請>> LightBlue
skinparam ActivityBackgroundColor<<受付>> LightGreen
skinparam ActivityBackgroundColor<<人間>> LightPink
skinparam ActivityBackgroundColor<<自動>> LightCyan

start

:申請データ作成<<申請前>>|

if (申請タイプ?) then (新規申請または名称変更)
    :人による部店名カナ入力<<人間>>|
else (その他の変更)
    :部店名カナ欄:空欄のまま|
endif

:一括申請フェーズ<<申請>>|

:統一フォーマットに変換|
note right: 部店カナを統合レイアウトにマッピング対象に

:受付フェーズ<<受付>>|

:受付フェーズ<<受付前処理>>|
note right: 受付: 前処理でリファレンステーブルから部店カナ補填

if (部店名カナ欄が空欄?) then (はい)
    :リファレンステーブルから\n部店名カナ取得<<自動>>|
else (いいえ)
    :入力された部店名カナを使用|
endif

:その他の受付処理|

stop

@enduml
----

== チェックリスト
[source]
----
部店名カナ設定チェックリスト（拗音対応・公式情報確認・特殊略称対応版）

1. 基本情報の確認
- [ ] 部店名称（漢字）が正確に記載されているか確認
- [ ] 地名を含む部店名称の場合、銀行公式HPで読み方を確認
- [ ] 関連会社の場合、その会社の公式HPで企業名を確認

2. 特殊略称・記号の確認
- [ ] 以下の略称や記号が含まれている場合、カナ読み替えの対象外として扱う：
- [ ] ㈱ （株式会社）
- [ ] （財） （財団法人）
- [ ] （社） （社団法人）
- [ ] （独） （独立行政法人）
- [ ] ㈾ （合資会社）
- [ ] ㈴ （合名会社）
- [ ] ㈲ （有限会社）
- [ ] これらの略称や記号は、カナ表記せずそのまま残すことを確認

3. 基本ルール確認
- [ ] すべての文字が全角カタカナであることを確認（ひらがな、漢字、英数字、半角カナは使用しない）
- [ ] 濁点・半濁点が正しく付いているか確認
- [ ] 長音符（ー）が適切に使用されているか確認
- [ ] スペースが必要な箇所に正しく入っているか確認

4. 拗音の通常カナ表現への変換確認
- [ ] すべての拗音が通常のカナ表現に変換されているか確認
- [ ] チャ → チヤ
- [ ] チュ → チユ
- [ ] チョ → チヨ
- [ ] シャ → シヤ
- [ ] シュ → シユ
- [ ] ショ → シヨ
- [ ] ジャ → ジヤ
- [ ] ジュ → ジユ
- [ ] ジョ → ジヨ
- その他の拗音も同様に変換

5. 銀行特有の表記ルール
- [ ] 「銀行」→「ギンコウ」と正しく表記されているか
- [ ] 「支店」→「シヤテン」と正しく表記されているか
- [ ] 「出張所」→「シユツチヨウジヨ」と正しく表記されているか
- [ ] 地域名や固有名詞が正しくカナ表記されているか（銀行HPで確認した読み方に基づく）
- [ ] 数字を含む部店名の場合、数字が正しくカナ表記されているか（例：「1」→「イチ」）

6. 関連会社の表記確認
- [ ] 関連会社名が公式HPの表記と一致しているか確認
- [ ] 関連会社名のカナ表記が公式情報と整合しているか確認
- [ ] 関連会社特有の表記ルールがある場合、それに従っているか確認

7. 特殊文字・記号の確認
- [ ] 中黒点（・）が必要な箇所に正しく使用されているか確認
- [ ] 括弧（）が必要な場合、正しく使用されているか確認
- [ ] その他の特殊文字や記号が不要に使用されていないか確認

8. 一貫性チェック
- [ ] 同じ漢字・単語に対して、一貫したカナ表記が使用されているか
- [ ] 既存の部店カナ表記との整合性が取れているか
- [ ] 拗音の通常カナ表現が一貫して使用されているか確認
- [ ] 特殊略称・記号の扱いが一貫しているか確認

9. 文字数・長さ
- [ ] カナ表記が適切な長さ（システムの制限内）であることを確認
- [ ] 拗音の通常カナ表現により文字数が増加していないか確認
- [ ] 必要以上に省略されていないか確認

10. システム入力時の注意
- [ ] 全角カタカナのみで入力されていることを確認（特殊略称・記号を除く）
- [ ] 拗音が通常のカナ表現（例：チョ→チヨ）で入力されているか確認
- [ ] 入力欄の文字数制限を超えていないか確認（拗音の通常カナ表現による文字数増加に注意）
- [ ] コピー＆ペーストした場合、余分な空白や改行が入っていないか確認

11. 最終確認
- [ ] 部店名（漢字）と部店カナの対応が正しいか再確認
- [ ] 誤字・脱字がないか全体を通して確認
- [ ] すべての拗音が通常のカナ表現に正しく変換されているか再確認
- [ ] 特殊略称・記号が正しく処理されているか再確認
- [ ] 銀行HP（地名を含む部店名称の場合）または関連会社HP（関連会社の場合）の情報と一致しているか最終確認
- [ ] 発音して違和感がないか確認（特に拗音を含む箇所）

----