//属性定義
include::../../../res/def/properties.adoc[]
:imagesdir: ../../../res/img
:onwer: 

[[xx.yyyyyyyyyyyyyyyy]]
= 部店名カナ設定運用 機能設計書

== 現状の課題
現行では人による判断で部店名称から部店カナを運用者が入力する運用を行っている。ただし過去にはそのカナ名称判断にゆらぎがあり、ベースのルールはあるものの本来ある要件を満たさないデータとして存在している。

* 人的ミス：手動での入力や確認作業により、誤入力や見落としが発生している +
* 公式情報との不整合：銀行や関連会社の公式情報と、システム上の表記が異なるケースが散見される +
* 系統的なチェック機能の不足：入力されたカナ表記の妥当性を系統的にチェックする仕組みが不十分 +

== 移植での課題対応

部店名称から部店カナを生成する実装を検討したものの、銀行固有ルール適用に多岐にわたるルール設定や既存のリファレンスデータの不備により変換精度は100%に至らない結果となった。またコードの保守性は低いコードとなってしまい将来に渡り負の資産になる懸念がある。

従って、移植時でも人による判断で部店カナを設定する運用でやむなしとする。ただし部店カナ設定の際にはルール厳格化/チェックリストによる検出を行い現状から改良できるよう仕組みを設定する。またValidationの仕組みを導入しチェックを併用することで誤入力リスクを縮小する。

== 継続検討課題
* 新規の場合は一括申請フェーズで部店カナ記載ありValidationを設定する,本件向けのValidationセットを設計する
* 変更の場合、部店名称変更時に運用担当者の対応漏れ検出
** カナ入力が漏れると、リファレンステーブルからの情報をセットする挙動になる
** 部店名称を比較対象とせざるを得ないが、不安定な情報をベースに判断をするべきか

.移植後の対処
[cols="1,3", options="header"]
|===
|目的                   |説明
|カナ表記の標準化       |拗音・長音・促音の処理や特殊文字の扱いを明確に定義し、一貫した表記を実現する
|公式情報との整合性確保 |銀行HPや関連会社HPとの照合を実装し、正確性を向上させる
|ユーザー支援の強化     |チェックリストやValidationエラー警告機能を通じて、操作者の判断をサポートする
|データ品質の向上       |厳密な検証プロセスにより、部店名カナデータの全体的な品質を向上させる
|===

== 機能要件
=== 部店名カナ

.基本情報入力
[cols="1,3", options="header"]
|===
|機能|説明
|部店名称（漢字）の入力|部店の正式名称を漢字で入力する
|===

.カナ表記変換
[cols="1,3", options="header"]
|===
|機能|説明
|拗音の通常カナ表現への変換|拗音を通常のカナ表現に変換する（例：チョ→チヨ）
|長音符（ー）の適切な使用|カナ表記における長音符の適切な使用を管理する
|促音符（っ）の適切な使用|カナ表記におけるf促音符の適切な使用を管理する
|===

.特殊文字・略称処理
[cols="1,3", options="header"]
|===
|機能|説明
|略称のカナ変換対象外処理|㈱、（財）、（社）などの略称をカナ変換対象外として処理する
|特殊文字の適切な処理|中黒点（・）、括弧（）などの特殊文字を適切に処理する
|===


.データ検証機能
[cols="1,3", options="header"]
|===
|機能|説明
|入力データの妥当性チェック
a|
* 必須項目の入力チェック
* 文字種の妥当性チェック（全角カタカナ、許可された特殊文字のみ）

|文字種・文字数チェック
a|
* 全角カタカナのみであることの確認（特殊略称・記号を除く）
* システムの文字数制限内であることの確認
|===

.公式情報参照
[cols="1,3", options="header"]
|===
|機能|説明
|銀行HP参照
a|
* 運用者が対応する 
|関連会社HP参照
a|
* 運用者が対応する 
|===

=== ユーザー支援機能

==== チェックリスト
* 部店名カナ設定チェックリストの定義
* チェックリストの各項目に対する確認実施

==== エラー・警告メッセージ表示
* Validation結果に基づくエラーメッセージの表示

== 処理フロー

=== 部店名カナ設定フロー

==== 申請データへ部店カナ入力判断
. 新規申請または部店名称変更の場合、運用者が部店名カナを入力
. その他の変更の場合、部店カナ欄を空欄のままとする

==== 一括申請フェーズ
. 部店カナ設定済申請データ処理
. 入力データの基本的なバリデーション

==== 統一フォーマット変換
. 申請フォームのデータを統一フォーマットに変換
. 部店カナを統合レイアウトにマッピング

==== 受付フェーズ
. 統一フォーマットデータの読み込み
. 部店カナ欄が空欄の場合、リファレンステーブルから部店カナを取得
. 部店カナ欄が入力済みの場合、その値を使用

[plantuml]
----
@startuml
skinparam ActivityBackgroundColor<<申請前>> LightYellow
skinparam ActivityBackgroundColor<<申請>> LightBlue
skinparam ActivityBackgroundColor<<受付>> LightGreen
skinparam ActivityBackgroundColor<<人間>> LightPink
skinparam ActivityBackgroundColor<<自動>> LightCyan

start

:申請データ作成<<申請前>>|

if (申請タイプ?) then (新規申請または名称変更)
    :人による部店名カナ入力<<人間>>|
else (その他の変更)
    :部店名カナ欄:空欄のまま|
endif

:一括申請フェーズ<<申請>>|

:統一フォーマットに変換|
note right: 部店カナを統合レイアウトにマッピング対象に

:受付フェーズ<<受付>>|

:受付フェーズ<<受付前処理>>|
note right: 受付: 前処理でリファレンステーブルから部店カナ補填

if (部店名カナ欄が空欄?) then (はい)
    :リファレンステーブルから\n部店名カナ取得<<自動>>|
else (いいえ)
    :入力された部店名カナを使用|
endif

:その他の受付処理|

stop

@enduml
----

== チェックリスト
[source]
----
部店名カナ設定チェックリスト

1. 基本情報の確認
- [ ] 部店名称（漢字）が正確に記載されているか確認
- [ ] 地名を含む部店名称の場合、銀行公式HPで読み方を確認

2. 特殊略称・記号の確認
- [ ] 以下の略称や記号が含まれている場合、カナ読み替えの対象外として扱う：
- [ ] ㈱ （株式会社）
- [ ] ㈶ （財団法人）
- [ ] ㈳ （社団法人）
- [ ] （独立行政法人）
- [ ] ㈾ （合資会社）
- [ ] ㈴ （合名会社）
- [ ] ㈲ （有限会社）

3. 基本ルール確認
- [ ] すべての文字が半角カタカナであることを確認（ひらがな、漢字、英数字、全角カナは使用しない）
- [ ] 固有名詞が適切に変換されているか確認 
- [ ] 濁点・半濁点が正しく付いているか確認
- [ ] 長音符（ー）が適切に使用されているか確認
- [ ] 促音符（っ）が適切に使用されているか確認

4. 拗音の通常カナ表現への変換確認
- [ ] すべての拗音が通常のカナ表現に変換されているか確認
- [ ] チャ → チヤ
- [ ] チュ → チユ
- [ ] チョ → チヨ
- [ ] シャ → シヤ
- [ ] シュ → シユ
- [ ] ショ → シヨ
- [ ] ジャ → ジヤ
- [ ] ジュ → ジユ
- [ ] ジョ → ジヨ
- その他の拗音も同様に変換

5. 銀行特有の表記ルール
- [ ] 「支店」→「シテン」付与にゆらぎがないか、国内・海外で統一されているか
- [ ] 地域名や固有名詞が正しくカナ表記されているか（銀行HPで確認した読み方に基づく）
- [ ] 数字を含む部店名の場合、数字が正しくカナ表記されているか（例:「1」→「ｲﾁ」）
- [ ] 漢数字を含む部店名の場合、数字が正しくカナ表記されているか（例:「三菱」→「ﾐﾂﾋﾞｼ」）

6. 関連会社の表記確認
- [ ] 関連会社名が公式HPの表記と一致しているか確認
- [ ] 関連会社名のカナ表記が公式情報と整合しているか確認
- [ ] 関連会社特有の表記ルールがある場合、それに従っているか確認
- [ ] 法人略語が適切に処理されているか確認 

7. 特殊文字・記号の確認
- [ ] 括弧（）が必要な場合、正しく使用されているか確認
- [ ] その他の特殊文字や記号が不要に使用されていないか確認

8. 文字数・長さ
- [ ] カナ表記が適切な長さ（システムの制限内）であることを確認
- [ ] 拗音等の通常カナ表現により文字数が増加していないか確認
- [ ] 必要以上に省略されていないか確認

9. 最終確認
- [ ] 部店名（漢字）と部店カナの対応が正しいか再確認
- [ ] 誤字・脱字がないか全体を通して確認
- [ ] すべての拗音・長音・促音が通常のカナ表現に正しく変換されているか再確認
- [ ] 特殊略称・記号が正しく処理されているか再確認
- [ ] 銀行HP（地名を含む部店名称の場合）または関連会社HP（関連会社の場合）の情報と一致しているか最終確認
- [ ] 発音して違和感がないか確認
- [ ] 国内、海外、関連で整合性のある変換、表記となっているか確認 
----