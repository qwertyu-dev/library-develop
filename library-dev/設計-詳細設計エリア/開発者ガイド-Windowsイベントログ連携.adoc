= Windowsイベントログ出力ガイダンス

== Windowsイベントログ出力ガイドライン

本ガイドラインは、アプリケーション開発者が重要なシステムイベントやエラーを適切にWindowsイベントログに記録するための指針を提供します。これにより、システムの安定性監視と迅速な問題対応が可能となります。

=== 目的

* 重要なシステムイベントやエラーの一貫した記録
* 運用部門による効果的な監視と迅速な対応の実現
* システムの安定性と信頼性の向上

=== 適用範囲

本ガイドラインは、Windows環境で動作する全てのアプリケーションに適用されます。

== `WindowsEventLogger` クラスの概要と使用方法

`WindowsEventLogger`クラスは、Windowsイベントログへの書き込みを簡素化するための共通ライブラリです。

=== 主要メソッド

* `write_info_log(src: str, evt_id: str, strings: list) -> None`
* `write_error_log(src: str, evt_id: str, strings: list) -> None`

=== 基本的な使用例

[source,python]
----
from src.lib.common_utils.windows_eventlog import WindowsEventLogger

# 情報ログの記録
WindowsEventLogger.write_info_log(
    src="リファレンスアプリケーション",
    evt_id="1001",
    strings=["処理が正常に完了しました", "追加情報"]
)

# エラーログの記録
WindowsEventLogger.write_error_log(
    src="リファレンスアプリケーション",
    evt_id="3001",
    strings=["重大なエラーが発生しました", "エラーの詳細情報"]
)
----

== エラーログ出力の基準と重要性

エラーログの出力は、以下の基準に基づいて行ってください：

1. 業務継続が不可能な状況
2. システムの意図的な停止が必要な場合
3. 外部システムとのデータ転送で重大なエラーが発生した場合
4. セキュリティ上の重大なイベント
5. パフォーマンスが著しく低下した場合

これらの状況では、必ず `write_error_log` メソッドを使用してイベントログに記録してください。適切なログ出力により、問題の迅速な検出と対応が可能となります。

== イベントID・ソース名・メッセージ構造の標準化

=== イベントID

* 1000番台: 情報ログ
* 2000番台: 警告ログ
* 3000番台: エラーログ

具体的な割り当ては以下の通り：

* 3001: 業務継続不可能エラー
* 3002: 意図的なシステム停止
* 3003: データ転送エラー

=== ソース名（src）

アプリケーション名またはモジュール名を一貫して使用してください。
例：`"リファレンスアプリケーション"`, `"ユーザID管理アプリケーション"`

=== メッセージ構造

`strings` リストは以下の構造を持つようにしてください：

1. 最初の要素: エラーの概要
2. 2番目の要素: 詳細情報

== 業務継続不可能エラーの記録方法

業務継続が不可能な状況では、以下のように記録してください：

[source,python]
----
try:
    # 重要な業務処理
    raise IOError("ファイルOPENに失敗しました")
except CriticalDatabaseError as e:
    WindowsEventLogger.write_error_log(
        src="リファレンスアプリケーション",
        evt_id="3001",
        strings=["業務継続不可能エラー: ファイル障害", str(e)]
    )
    # アプリケーションの安全な終了処理
----

== 外部システム連携エラーの記録方法

外部システムとの連携でエラーが発生した場合は、以下のように記録してください：

[source,python]
----
try:
    # 外部システムとのデータ転送処理
    raise ConnectionError("外部システムとの接続がタイムアウトしました")
except ConnectionError as e:
    WindowsEventLogger.write_error_log(
        src="リファンレンスアプリケーション",
        evt_id="3003",
        strings=["データ転送エラー: 共通認証システム宛送信", str(e)]
    )
    # エラーハンドリング（再試行ロジックなど）
----

== 運用部門との連携：監視設定と通知

1. 運用部門に対して、以下のイベントIDを重点的に監視するよう依頼してください: 
   * 3001: 業務継続不可能エラー
   * 3002: 意図的なシステム停止
   * 3003: データ転送エラー

2. これらのイベントIDが検出された場合、即時に担当者へ通知が行われるよう設定を依頼してください。

3. 定期的に運用部門と協議し、監視対象のイベントIDや通知ルールの見直しを行ってください。

4. 新しいタイプのエラーや重要なイベントを追加する際は、運用部門と協力して適切な監視設定を行ってください。
