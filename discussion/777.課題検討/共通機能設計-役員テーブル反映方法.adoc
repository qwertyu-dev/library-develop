= 秘書室からの個別対応（指定部点を役員扱い/BPR定義）を行う

秘書室から、特定の部店について「役員」にして欲しいという要望があり
現行ではリファレンステーブルをダイレクト修正していますが
これをやめて、運用フローにのせて運用するよう変更します。

== 役員部署対応の検討事項整理

=== 運用上の課題

==== 現状の問題点
* 組織情報管理の二重構造:
** 通常の組織情報管理: 人事部が担当
** 役員設定: 秘書室が個別に依頼
* 人事部と秘書室の連携不足:
** 互いの申請内容を把握していない
** 情報の不一致リスクが高い

== 役員部署対応策の比較と優先度

[cols="1,2,2,1", options="header"]
|===
|対応策 |メリット |デメリット |優先度

|1. 都度パッチ適用
|・直接的で即時的な対応が可能 +
・変更の影響範囲が限定的
|・運用負荷が非常に高い +
・エラーリスクが大きい +
・長期的には非効率
|4 (最低)

|2. 受付フェーズでの編集
|・柔軟な対応が可能 +
・早い段階で修正可能
|・既存ポリシーに反する +
・受付処理の複雑化 +
・部店依存処理の一貫性が損なわれる
|3

|3. パターン編集での対応（専用Facade）
|・既存ポリシーに準拠 +
・処理の一貫性を維持 +
・将来的な拡張性が高い
|・新たな開発が必要 +
・保守の複雑さが増す可能性 +
・実装に時間がかかる
|2

|4. 反映・一括反映・送信フェーズでの対応
|・既存プロセスを大きく変更せずに実装可能 +
・テーブルマッピングによる柔軟な対応 +
・運用負荷とエラーリスクを最小化
|・処理のタイミングが遅くなる可能性 +
・一括処理のパフォーマンスに影響する可能性
|1 (最高)
|===

=== 採択優先度の理由：

1. 反映・一括反映・送信フェーズでの対応
* 既存システムへの影響が最小限
* 柔軟性と保守性のバランスが良好
* 運用負荷が比較的低い

2. パターン編集での対応（専用Facade）
* ポリシーに準拠しつつ、柔軟な対応が可能
* 将来的な拡張性が高い
* 開発コストと時間がやや必要

3. 受付フェーズでの編集
* 柔軟な対応が可能だが、既存ポリシーに反する
* システムの一貫性を損なう可能性がある

4. 都度パッチ適用
* 運用負荷が非常に高く、長期的には持続不可能
* エラーリスクが高く、避けるべき選択肢

== 役員表示部署変換テーブルレイアウト案

[cols="2,2,1,2,3", options="header"]
|===
|項目名 |データ型 |必須 |デフォルト値 |備考

|部店コード |VARCHAR(10) |○ |- |主キー
|部店名 |VARCHAR(100) |△ |- |必要性要検討、固定値にしたいが曖昧
|BPR部店コード |VARCHAR(10) |○ |- |
|BPR部店名 |VARCHAR(100) |○ |- |
|課Grコード |VARCHAR(10) |○ |- |
|課Gr名称 |VARCHAR(100) |○ |- |
|DPコード |VARCHAR(10) |○ |- |
|DPコード（行員外） |VARCHAR(10) |○ |- |
|表示順 |INT |○ |0000 |必要性要検討 人事部店に対するレコードの表示順-1を設定
|更新日時 |TIMESTAMP |○ |CURRENT_TIMESTAMP |
|更新者 |VARCHAR(50) |○ |- |
|===

=== 備考
1. 部店名：必要性を再検討。情報の冗長性vs参照の利便性を考慮。
2. 表示順：デフォルト値を0000に設定。必要性と使用方法を再確認。
3. DPコード：特殊なケース（DP6901, DP6901P）の扱いを明確化。
4. 部店コード：特殊なケース（-1に設定）の扱いを明確化。
5. 役員フラグ：秘書室からの個別設定を識別するために追加。
6. 更新日時と更新者：監査とトレーサビリティのために追加。

=== 検討事項
1. インデックス設計：検索性能向上のため、頻繁に使用される検索条件に基づいてインデックスを設計する。
2. 外部キー制約：関連テーブルとの整合性を保つため、適切な外部キー制約を設定する。
3. アクセス制御：人事部と秘書室の権限を適切に設定し、不正な更新を防ぐ。
4. 履歴管理：重要な変更履歴を別テーブルで管理するか検討する。

== フロー定義(一括反映で対処パターン)

[plantuml]
----
@startuml
!define RECTANGLE class

skinparam rectangle {
    roundCorner 25
}

start
:開始;

if (申請タイプ?) then (人事部一括申請)
    :受付;
    :パターン編集;
    :反映・一括反映・送信フェーズ;
    :リファレンステーブル反映;
else (秘書室個別申請)
    :コン関連で受信;
    :役員テーブルUpdate用パッチ発行;
    :役員テーブル更新;
endif

:一括反映処理開始;

while (レコード毎に処理)
    if (秘書室からの役員設定あり?) then (Yes)
        :役員情報を優先して更新;
    else (No)
    endif
    :次のレコードへ;
endwhile

:更新完了;
:ログ記録;
:関連システムへの通知;

:終了;
stop

@enduml
----