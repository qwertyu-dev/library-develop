<role>
あなたは世界最高のアプリケーション設計エンジニアです
あなたの仕事は、要件に対するアプリケーションデザイン最適化を提案することです。
</role>

<requirement-analysis>

# システム概要
- 会社の部署情報（部署コード、部署名など）が入っているデータを保持しそれに対する変更申請を管理するシステムについて検討しています

# データライフサイクル
データには以下の４フェーズがある
- 一括申請
  - 申請部署から、Excelによる部署情報更新データの提供がある
  - 主だったデータ更新には「新設・変更・廃止」の３パターンがある、その他にもその条件下で様々な項目情報が提示される
  - 申請データにはValidaion／整合性チェックが必要である
  - 申請データのフォーマットは部署ごとにバラバラであり、システム処理効率化のためチェック処理の後にフォーマット統一変換を行う
- 受付
  - いわゆる「前処理」を行い、申請データの編集や情報補填を行う
  - 現行アプリは複雑なifネストや個別処理実装を行っているがシステム保守上のボトルネックとなっており、リファクタリングが必須である
  - 条件制御で100パターン程度が見込まれている
- パターン処理
  - 規定された編集パターンにより、受付処理後のデータからテーブル更新明細を生成する
  - 主に部店番により分岐制御を行う、分岐制御パターンは106程がある
  - 分岐制御で呼び出される編集パターンはそれぞれ独立に定義を保有している
- 反映・送信
  - 反映
    - 明細が持つ反映日Keyに、テーブルへの更新明細反映処理を行う
    - 運用パラメータ制御により、反映指定日前にデータ仮反映を行う
    - カレンダーは銀行カレンダーを取得し、営業日での制御を行う
  - 送信
    - CSVファイルと制御ファイルを作成する
    - 更新日にCSVファイルと制御ファイルを関連システムへSFTP送信する
    - 仮反映データ及び本反映データを送信する

# 保有属性/階層定義
部署の階層構造は部とその配下で以下の要素を持っています、他にもいくつかの属性を持っている
- 主だった要素
  - 部コード
  - 部名
  - 課コード
  - 課名

# カラム間のリレーション定義
- 課コードと課名のカラムが空白の明細は部を表す
- 課コードと課名に値が入っていれば部の配下である課を表す
- すでにデータベースに登録されている部コードと課コードは変更されない

# 申請パターン
申請情報一覧のテーブルは以下の３種類の申請が入っています
- 新設：部や課の新設設定です、部コードと課コード、既存でない部名と課名を含んだ明細です
- 変更：既存の部や課に対する変更申請です。既存の部コードと課コード、変更後の部名と課名を含んだ申請です
- 廃止：既存の部や課に対する廃止申請です。既存の部コードと課コード、既存の部名と課名を含んだ申請です

# 変更申請利用
このシステムには、部に対する変更申請が行われた場合、その配下の課がのレコードが持つ部名も最新化するという仕組みがあります。
具体的には部に対する部名の変更申請から、配下の課のレコードを更新する明細を作成します。
データ正規化を行っていないために１箇所更新というデザインにはなっていないのが理由です。

# 個別保有テーブル
システム実装最適化のため、いくつかの固定値を持つテーブルを保有します
- 保有するテーブルの例
  - BPR部門コード（部を上位のレイヤーで区分分類する）
  - 出向リカバリフラグ（個別の条件により権限付与制御する）
  - 銀行カレンダー（銀行特有の営業日・休業日カレンダーを保有）
</requirement-analysis>