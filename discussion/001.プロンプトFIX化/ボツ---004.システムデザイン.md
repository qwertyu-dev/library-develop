<システムデザイン要件>
<一括申請>
- Excelデータの提示がある,ただし申請3部署（人事、海外、関連）のExcelフォーマットは異なっている
- Excelデータに対するValidaionチェックを行う（項目単体の型、範囲チェック）
- Excelデータに対する整合性チェックを行う（別項目との連携チェック、他テーブルデータ保有値とのチェック）
- チェックOKであればExcelデータをDataFrameへ変換する
- DataFrameは異なるExcelフォーマットを統合フォーマットへ変換する
- 統合フォーマット後のデータは永続化（pickle）する
</一括申請>

<受付>
- <一括申請>で作成した統合フォーマット後のデータを使用する
- 入力データに対して「前処理」を担当する
- 仕様変更や異例ケースを吸収しなるべく後続処理に変更が入らないような役割を担う
- 現行実装ではifネストが異様に深かったり、異例ケースが突然ベタ書きされたりと、保守効率化に問題がある
- main/Factory/Fadace/編集部品構成デザインに変更する
- Factoryでのif条件（and orの組み合わせ）は約6段階がある
- Facadeは約100パターンを想定する
- データ編集部品は50個程度を利用する
- データ補完処理があり、システム内のテーブルデータから取得する
- Factoryで、異例ケースデータはアーリーリターンの考え方を導入する
- 入力データの受付処理後のデータは永続化（pickle）する
</受付>
　
<パターン処理>
- <受付>で作成した永続化データを使用する
- リファレンステーブルデータ更新用の明細データを生成する
- 部店コード条件などにより、その条件で一意化したデータ編集パターン定義を呼び出しテーブル更新用の明細データを作成する
- CUDパターンで処理できる明細を作成する（Rは無い）
- main/Factory/Fadace/編集部品構成デザインに変更する
- Factoryでのif条件合わせは部店番コードの組み合わせにより決定する(複数の部店番に対する条件組み合わせ)
- Facadeは約100パターンを想定する
- データ編集部品は50個程度を利用する
- データ補完処理があり、システム内のテーブルデータから取得する
- 入力データのパターン処理後のデータは永続化（pickle）する
</パターン処理>

<反映・送信>
- <パターン処理>で生成した永続化データを使用する（DB更新情報明細）
- DB更新情報明細によりリファレンステーブルを更新する
- DB更新情報明細に反映日付が定義されており、その日付に則りテーブル更新する
- ダミー課Gr情報を取得しダミー課テーブルを作成する
- 関連システムに渡すデータはリファレンステーブル及びダミー課テーブルレコードが対象となる
- 文書切替
  - 定義した事前提供日には受渡し側の要件に從いデータ加工しCSV化して送付する
  - 反映日5営業日前ケース
  - 反映日前日ケース
- 送信するCSVファイルはバリデーションチェックを行う
- メール送信
  - 部店新規・廃止の場合に実行する
  - リファレンステーブル更新連絡とともに、部店情報.txtを作成しメール添付する
- テーブル更新前にテーブルファイルを物理コピーを行い履歴保有する
</反映・送信>

</システムデザイン要件>
